

{% extends "layout.html" %}

{% block title %}
    Task Manager
{% endblock %}

{% block style %}

 <style>
        /* Custom styles to enhance Bootstrap */
        .task-header {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* Space between elements in the header */
            margin-bottom: 0.5rem;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
        }
        .task-header input[type="text"],
        .task-header input[type="date"] {
            flex-grow: 1; /* Allow inputs to take up available space */
            min-width: 150px; /* Ensure inputs don't get too small */
        }
        .task-options {
            margin-bottom: 0.5rem;
        }
        .subtask-list {
            padding-left: 1.5rem; /* Indent subtasks */
            border-left: 2px solid #0d6efd; /* Visual cue for subtasks */
            margin-top: 1rem;
        }
    </style>

{% endblock %}

{% block main %}

    <div class="container mt-5">
        <h1 class="mb-4">My Dynamic Tasks</h1>
        <form id="task-manager-form" action="/save-tasks" method="POST">
            <div class="task-list">
                {% macro render_task_item(task, is_subtask=false) %}
                <div class="card {% if is_subtask %}card-body bg-light{% endif %} mb-3" data-task-id="{{ task.id }}">
                    <div class="card-body">
                        <div class="task-header">
                            <div class="form-floating flex-grow-1">
                                <input type="text" class="form-control" id="task_name_{{ task.id | replace('.', '_') }}" name="task_name_{{ task.id | replace('.', '_') }}" value="{{ task.name }}" placeholder="Task Name">
                                <label for="task_name_{{ task.id | replace('.', '_') }}">Task Name</label>
                            </div>
                            {% if task.due_date is defined %}
                            <div class="form-floating">
                                <input type="date" class="form-control" id="due_date_{{ task.id | replace('.', '_') }}" name="due_date_{{ task.id | replace('.', '_') }}" value="{{ task.due_date }}" placeholder="Due Date">
                                <label for="due_date_{{ task.id | replace('.', '_') }}">Due Date</label>
                            </div>
                            {% endif %}
                            <button onclick=    type="button" class="btn {% if is_subtask %}btn-sm btn-outline-primary{% else %}btn-primary{% endif %} add-subtask-btn">Add Subtask</button>
                            <button type="button" class="btn {% if is_subtask %}btn-sm btn-outline-danger{% else %}btn-danger{% endif %} delete-task-btn">Delete</button>
                        </div>
                        <div class="task-options mb-3">
                            <div class="form-floating mb-2">
                                <textarea class="form-control" placeholder="Task Description" id="description_{{ task.id | replace('.', '_') }}" name="description_{{ task.id | replace('.', '_') }}" style="height: 100px;">{{ task.description }}</textarea>
                                <label for="description_{{ task.id | replace('.', '_') }}">Description</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="completed_{{ task.id | replace('.', '_') }}" name="completed_{{ task.id | replace('.', '_') }}" {% if task.completed %}checked{% endif %}>
                                <label class="form-check-label" for="completed_{{ task.id | replace('.', '_') }}">Completed</label>
                            </div>
                        </div>
                        {% if task.subtasks %}
                        <div class="subtask-list">
                            {% for subtask in task.subtasks %}
                                {{ render_task_item(subtask, true) }} {# Recursive call with is_subtask=true #}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endmacro %}

                {% for task in tasks %}
                    {{ render_task_item(task) }} {# Initial call for main tasks #}
                {% endfor %}
            </div>
            <button type="submit" class="btn btn-success mt-3">Save All Tasks</button>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const detailButtons = document.querySelectorAll('.details-button');
            detailButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // ADD NEW SUBTASK
                    
                });
            });
        });
    </script>

{% endblock %}